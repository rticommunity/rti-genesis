<!DOCTYPE html>
<html>
<head>
    <title>Node Positioning Test</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .network-container {
            width: 600px;
            height: 400px;
            border: 2px solid #333;
            margin: 20px;
        }
        .node { cursor: pointer; }
        .node-interface { fill: #3498db; stroke: #2980b9; }
        .node-agent { fill: #e74c3c; stroke: #c0392b; }
        .node-label { font-size: 12px; text-anchor: middle; fill: white; font-weight: 600; }
    </style>
</head>
<body>
    <h1>Genesis Node Positioning Test</h1>
    <div class="network-container">
        <svg id="test-svg" width="100%" height="100%"></svg>
    </div>
    <button onclick="testPositioning()">Test Node Positioning</button>
    <div id="output"></div>

    <script>
        let svg, g, simulation;
        
        function init() {
            svg = d3.select('#test-svg');
            g = svg.append('g');
            
            simulation = d3.forceSimulation()
                .force('link', d3.forceLink().id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(300, 200))
                .force('collision', d3.forceCollide().radius(30));
        }
        
        function getSVGDimensions() {
            svg.node().offsetHeight;
            const rect = svg.node().getBoundingClientRect();
            let width = rect.width;
            let height = rect.height;
            
            if (width < 100) width = 600;
            if (height < 100) height = 400;
            
            return { width, height, centerX: width / 2, centerY: height / 2 };
        }
        
        function testPositioning() {
            const testData = {
                nodes: [
                    { id: 'node1', name: 'Interface', type: 'interface' },
                    { id: 'node2', name: 'Agent1', type: 'agent' },
                    { id: 'node3', name: 'Agent2', type: 'agent' },
                    { id: 'node4', name: 'Service', type: 'interface' }
                ],
                edges: []
            };
            
            updateVisualization(testData);
        }
        
        function updateVisualization(data) {
            g.selectAll('*').remove();
            
            if (!data.nodes || data.nodes.length === 0) return;
            
            const { width, height, centerX, centerY } = getSVGDimensions();
            
            document.getElementById('output').innerHTML = 
                `SVG dimensions: ${width}x${height}, center: (${centerX}, ${centerY})`;
            
            // Position nodes in circle
            data.nodes.forEach((node, i) => {
                const angle = (i / data.nodes.length) * 2 * Math.PI;
                const radius = Math.min(centerX, centerY) * 0.3;
                node.x = centerX + Math.cos(angle) * radius;
                node.y = centerY + Math.sin(angle) * radius;
            });
            
            const nodes = g.selectAll('.node')
                .data(data.nodes)
                .enter().append('g')
                .attr('class', 'node');
            
            nodes.append('circle')
                .attr('r', 20)
                .attr('class', d => `node node-${d.type}`);
            
            nodes.append('text')
                .attr('class', 'node-label')
                .text(d => d.name);
            
            simulation
                .force('center', d3.forceCenter(centerX, centerY))
                .nodes(data.nodes)
                .on('tick', () => {
                    nodes.attr('transform', d => `translate(${d.x},${d.y})`);
                });
            
            simulation.alpha(1).restart();
        }
        
        window.onload = init;
    </script>
</body>
</html> 